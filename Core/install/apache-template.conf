<VirtualHost *:80>
	ServerName @sitename@.sunesis.uk.net

	Redirect permanent / https://@sitename@.sunesis.uk.net/
</VirtualHost>

<VirtualHost *:443>
	ServerName @sitename@.sunesis.uk.net

	DocumentRoot  /srv/www/am_common/htdocs
	ErrorLog  /srv/www/@dirname@/logs/error_log
	CustomLog  /srv/www/@dirname@/logs/access_log perspective
	DirectoryIndex index.php
	
	Options none

	SSLEngine On
	BrowserMatch "MSIE" nokeepalive ssl-unclean-shutdown downgrade-1.0 force-response-1.0

	SetEnv PERSPECTIVE_DB_HOST        		localhost
	SetEnv PERSPECTIVE_DB_USER	        	@username@
	SetEnv PERSPECTIVE_DB_PASSWORD 			@password@
	SetEnv PERSPECTIVE_DB_NAME 				@dbname@
	SetEnv PERSPECTIVE_DATA_ROOT            "/srv/www/am_common_data"

	RewriteEngine On
	RewriteRule ^/([A-Za-z_]+)/([A-Za-z_]+)/?$ /do.php?_action=$1&subaction=$2 [QSA,R]
	RewriteRule ^/([A-Za-z_]+)$ /do.php?_action=$1 [QSA,R]

	Alias /yui /srv/www/yui
	<Directory /srv/www/yui>
		AllowOverride None
		Options Indexes
		Order allow,deny
		Allow from all

		<IfModule expires_module>
			ExpiresActive On
			ExpiresByType image/jpg "access plus 10 years"
			ExpiresByType image/jpeg "access plus 10 years"
			ExpiresByType image/gif "access plus 10 years"
			ExpiresByType image/png "access plus 10 years"
			ExpiresByType application/javascript "access plus 10 years"
			ExpiresByType text/css "access plus 10 years"
		</IfModule>
	</Directory>

	<Directory  /srv/www/am_common/htdocs>
		AllowOverride None
		Order allow,deny
		Allow from all
	</Directory>

	<Files phpinfo.php>
		Order allow,deny
		Allow from 127.0.0.1 217.10.129.18 80.195.116.88 84.12.57.179
	</Files>


	# Block access to PHP include paths
	<Directory  /srv/www/am_common/htdocs/shared>
		Order allow,deny
	</Directory>
	<Directory  /srv/www/am_common/htdocs/lib>
		Order allow,deny
	</Directory>
	<Directory  /srv/www/am_common/htdocs/*/actions>
		Order allow,deny
	</Directory>
	<Directory  /srv/www/am_common/htdocs/*/templates>
		Order allow,deny
	</Directory>


	#Alias /webfolder  /srv/www/@dirname@/webdav/default
	#<Directory  /srv/www/@dirname@/webdav/default>
	#	Order deny,allow
	#	Options Indexes

	#	Dav On

	#	AuthType Basic
	#	AuthName "Sunesis @sitename@ Web Folder"
	#	AuthBasicProvider file
	#	AuthUserFile  /srv/www/@dirname@/webdav/passwords
		
	#	<LimitExcept OPTIONS>
	#		Require valid-user
	#	</LimitExcept>
	#</Directory>

	# Allow browsers and proxies to cache site graphics for ten minutes before
	# issuing a GET request with the If-Not-Modified-Since HTTP header
	<IfModule expires_module>
		ExpiresActive On
		ExpiresByType image/jpg "access plus 10 minutes"
		ExpiresByType image/jpeg "access plus 10 minutes"
		ExpiresByType image/gif "access plus 10 minutes"
		ExpiresByType image/png "access plus 10 minutes"
		ExpiresByType application/javascript "access plus 10 minutes"
		ExpiresByType text/css "access plus 10 minutes"
	</IfModule>

	<IfModule deflate_module>
		 AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript
	</IfModule>
</VirtualHost>